{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://houseofconsequences.org/schemas/evidence.pack.schema.json",
  "title": "Evidence Pack Schema",
  "description": "Schema for structured evidence supporting a canonical decision lifecycle event.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "metadata",
    "scope",
    "methods",
    "findings",
    "attribution",
    "pdca_support",
    "governance_assessment"
  ],

  "properties": {
    "metadata": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "case_id",
        "domain",
        "version",
        "created_at",
        "authors",
        "data_sources"
      ],
      "properties": {
        "case_id": { "type": "string" },
        "domain": { "type": "string" },
        "version": {
          "type": "string",
          "pattern": "^\\d+\\.\\d+\\.\\d+$"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "authors": {
          "type": "array",
          "items": { "type": "string" }
        },
        "data_sources": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["provider", "dataset", "year"],
            "properties": {
              "provider": { "type": "string" },
              "dataset": { "type": "string" },
              "year": { "type": "integer", "minimum": 1900 }
            }
          }
        }
      }
    },

    "scope": {
      "type": "object",
      "additionalProperties": false,
      "required": ["population", "timeframe", "exclusions"],
      "properties": {
        "population": { "type": "string" },
        "timeframe": {
          "type": "object",
          "required": ["start_year", "end_year"],
          "properties": {
            "start_year": { "type": "integer" },
            "end_year": { "type": "integer" }
          }
        },
        "exclusions": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },

    "methods": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["method_type", "description"],
        "properties": {
          "method_type": { "type": "string" },
          "description": { "type": "string" },
          "controls": {
            "type": "array",
            "items": { "type": "string" }
          },
          "limitations": { "type": "string" }
        }
      }
    },

    "findings": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": ["metric", "baseline", "exposed", "unit"],
        "properties": {
          "metric": { "type": "string" },
          "baseline": { "type": ["number", "string"] },
          "exposed": { "type": ["number", "string"] },
          "unit": { "type": "string" },
          "confidence_interval": { "type": "string" }
        }
      }
    },

    "attribution": {
      "type": "object",
      "additionalProperties": false,
      "required": ["risk_difference", "hazard_ratio", "attributable_fraction", "economic_impact"],
      "properties": {
        "risk_difference": { "type": "number" },
        "hazard_ratio": { "type": "number" },
        "attributable_fraction": { "type": "number" },
        "economic_impact": {
          "type": "object",
          "additionalProperties": false,
          "required": ["per_case_cost", "annual_total_cost", "currency"],
          "properties": {
            "per_case_cost": { "type": "number" },
            "annual_total_cost": { "type": "number" },
            "currency": { "type": "string" }
          }
        }
      }
    },

    "pdca_support": {
      "type": "object",
      "additionalProperties": false,
      "required": ["plan_signal", "do_signal", "check_signal", "act_leverage_points"],
      "properties": {
        "plan_signal": { "type": "string" },
        "do_signal": { "type": "string" },
        "check_signal": { "type": "string" },
        "act_leverage_points": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },

    "governance_assessment": {
      "type": "object",
      "additionalProperties": false,
      "required": ["normalized_error_indicator", "structural_risk_score", "notes"],
      "properties": {
        "normalized_error_indicator": { "type": "boolean" },
        "structural_risk_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "notes": { "type": "string" }
      }
    }
  },

  "examples": [
    {
      "metadata": {
        "case_id": "canonical-casebook-0-normalized-error",
        "domain": "healthcare",
        "version": "1.0.0",
        "created_at": "2026-01-10T10:30:00Z",
        "authors": ["House of Consequences Governance"],
        "data_sources": [
          { "provider": "THL", "dataset": "Erikoissairaanhoidon hoitojonot", "year": 2024 },
          { "provider": "Tilastokeskus", "dataset": "Kuolemansyyt", "year": 2024 }
        ]
      },
      "scope": {
        "population": "Adults with delayed care > 3 months",
        "timeframe": { "start_year": 2022, "end_year": 2024 },
        "exclusions": ["Emergency care", "Children"]
      },
      "methods": [
        {
          "method_type": "cohort_comparison",
          "description": "Patients grouped by delay and compared.",
          "controls": ["age", "gender"],
          "limitations": "Non-randomized"
        }
      ],
      "findings": [
        {
          "metric": "1yr mortality",
          "baseline": 5,
          "exposed": 22,
          "unit": "%",
          "confidence_interval": "95% CI"
        }
      ],
      "attribution": {
        "risk_difference": 0.17,
        "hazard_ratio": 1.15,
        "attributable_fraction": 0.58,
        "economic_impact": {
          "per_case_cost": 21000,
          "annual_total_cost": 562000000,
          "currency": "EUR"
        }
      },
      "pdca_support": {
        "plan_signal": "Resourcing explanations dominate decision memos",
        "do_signal": "Delay correlates with complications",
        "check_signal": "Stable >6mo delays > 15%",
        "act_leverage_points": [
          "Separate capacity from prioritization",
          "Auto risk alerts >3mo",
          "Emergency buffer reduction"
        ]
      },
      "governance_assessment": {
        "normalized_error_indicator": true,
        "structural_risk_score": 0.92,
        "notes": "Delay is systemic risk, not a one-off."
      }
    }
  ]
}

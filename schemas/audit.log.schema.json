{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "AuditLogEntry",
  "type": "object",
  "required": ["event_id", "timestamp", "actor", "action", "target", "hash", "previous_hash"],
  "properties": {
    "event_id": { "type": "string", "format": "uuid" },
    "timestamp": { "type": "string", "format": "date-time" },
    "actor": {
      "type": "object",
      "required": ["id", "role"],
      "properties": {
        "id": { "type": "string" },
        "role": { "type": "string" }
      }
    },
    "action": { "type": "string" },
    "target": { "type": "string" },
    "metadata": { "type": "object", "additionalProperties": true },
    "hash": { "type": "string" },
    "previous_hash": { "type": "string" }
  }
}

    "actor": {
      "type": "object",
      "additionalProperties": false,
      "required": ["actor_id", "actor_type", "authentication_method"],
      "properties": {
        "actor_id": { "type": "string" },
        "actor_type": {
          "type": "string",
          "enum": ["human", "system", "service", "ai_agent"]
        },
        "authentication_method": {
          "type": "string",
          "enum": ["password", "mfa", "oauth", "pki", "qes", "service_account"]
        },
        "role": { "type": "string" },
        "organization": { "type": "string" }
      }
    },

    "action": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "operation", "status"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "create",
            "read",
            "update",
            "delete",
            "sign",
            "validate",
            "approve",
            "reject",
            "publish",
            "archive",
            "escalate"
          ]
        },
        "operation": { "type": "string" },
        "status": {
          "type": "string",
          "enum": ["success", "failure", "partial", "pending"]
        },
        "error_code": { "type": "string" },
        "error_message": { "type": "string" }
      }
    },

    "object": {
      "type": "object",
      "additionalProperties": false,
      "required": ["object_type", "object_id"],
      "properties": {
        "object_type": {
          "type": "string",
          "enum": [
            "decision",
            "evidence_pack",
            "policy",
            "schema",
            "report",
            "signature",
            "user",
            "system_config"
          ]
        },
        "object_id": { "type": "string" },
        "object_version": { "type": "string" },
        "object_hash": {
          "type": "string",
          "description": "Cryptographic hash (e.g., SHA-256) of the object state at the time of action."
        }
      }
    },

    "context": {
      "type": "object",
      "additionalProperties": false,
      "required": ["decision_id", "lifecycle_stage", "jurisdiction"],
      "properties": {
        "decision_id": { "type": "string" },
        "lifecycle_stage": {
          "type": "string",
          "enum": [
            "impact",
            "consequences",
            "adaptation",
            "compounding",
            "norm",
            "learning"
          ]
        },
        "jurisdiction": { "type": "string" },
        "legal_basis": { "type": "string" },
        "policy_reference": { "type": "string" },
        "case_reference": { "type": "string" }
      }
    },

    "integrity": {
      "type": "object",
      "additionalProperties": false,
      "required": ["hash", "previous_hash", "hash_algorithm", "chain_position"],
      "properties": {
        "hash": { "type": "string" },
        "previous_hash": { "type": "string" },
        "hash_algorithm": {
          "type": "string",
          "enum": ["SHA-256", "SHA-384", "SHA-512", "BLAKE2", "BLAKE3"]
        },
        "chain_position": {
          "type": "integer",
          "minimum": 0
        }
      }
    },

    "legal_status": {
      "type": "object",
      "additionalProperties": false,
      "required": ["evidentiary_class", "retention_policy", "admissibility"],
      "properties": {
        "evidentiary_class": {
          "type": "string",
          "enum": ["administrative", "regulatory", "judicial", "forensic"]
        },
        "retention_policy": { "type": "string" },
        "admissibility": {
          "type": "string",
          "enum": ["prima_facie", "supporting", "non_admissible"]
        },
        "data_protection_basis": {
          "type": "string",
          "enum": ["GDPR_6_1_c", "GDPR_6_1_e", "GDPR_6_1_f", "consent"]
        }
      }
    },

    "signature": {
      "type": "object",
      "additionalProperties": false,
      "required": ["signature_type", "signed_at", "signer_id"],
      "properties": {
        "signature_type": {
          "type": "string",
          "enum": ["none", "simple", "advanced", "qualified"]
        },
        "signed_at": {
          "type": "string",
          "format": "date-time"
        },
        "signer_id": { "type": "string" },
        "certificate_fingerprint": { "type": "string" },
        "signature_value": { "type": "string" },
        "signature_algorithm": { "type": "string" }
      }
    }
  },

  "examples": [
    {
      "log_id": "018f9d9b-3d7e-7b6a-bb9e-4fae2b6c9e11",
      "timestamp": "2026-01-18T04:22:33Z",
      "actor": {
        "actor_id": "user-29481",
        "actor_type": "human",
        "authentication_method": "qes",
        "role": "Decision Authority",
        "organization": "Ministry of Justice"
      },
      "action": {
        "type": "approve",
        "operation": "decision.approval",
        "status": "success"
      },
      "object": {
        "object_type": "decision",
        "object_id": "decision-rajamenettelylaki-2026",
        "object_version": "1.0.3",
        "object_hash": "c9b1f1a1e7c6b99e5b0e78b4d1f8e4c5c7a6d5f2b1a9e8d7c6b5a4f3e2d1c"
      },
      "context": {
        "decision_id": "decision-rajamenettelylaki-2026",
        "lifecycle_stage": "norm",
        "jurisdiction": "FI",
        "legal_basis": "Perustuslaki 2 ยง, Hallintolaki 6 ยง",
        "policy_reference": "Government Programme 2026",
        "case_reference": "HOCC-CASE-0001"
      },
      "integrity": {
        "hash": "a4f1b9d2c7e6f8a3b5c9d1e2f7a8c6b5d9e4a2c1b8f7e6d5c4b3a2f1e0d",
        "previous_hash": "0000000000000000000000000000000000000000000000000000000000000000",
        "hash_algorithm": "SHA-256",
        "chain_position": 0
      },
      "legal_status": {
        "evidentiary_class": "judicial",
        "retention_policy": "Permanent",
        "admissibility": "prima_facie",
        "data_protection_basis": "GDPR_6_1_c"
      },
      "signature": {
        "signature_type": "qualified",
        "signed_at": "2026-01-18T04:22:35Z",
        "signer_id": "QES-CERT-99887766",
        "certificate_fingerprint": "AB:CD:EF:12:34:56:78:90:AB:CD:EF:12:34:56:78:90",
        "signature_value": "BASE64ENCODEDSIGNATURE==",
        "signature_algorithm": "RSA-PSS-SHA256"
      }
    }
  ]
}
